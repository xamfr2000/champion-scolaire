<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>Conjugaison â€” Champion Scolaire</title>
  <link rel="stylesheet" href="css/style.css">
  <link rel="manifest" href="manifest.json">
  <meta name="apple-mobile-web-app-capable" content="yes">
</head>
<body>

<!-- ===== ACCUEIL CONJUGAISON ===== -->
<div id="screen-home" class="screen active">
  <div class="card">
    <h1>ğŸ“ Conjugaison</h1>
    <p class="subtitle" id="home-subtitle">Deviens un maÃ®tre des verbes !</p>

    <div class="level-badge">
      <div class="level-icon" id="level-icon">ğŸŒ±</div>
      <div class="level-info">
        <div class="level-name" id="level-name">Apprenti</div>
        <div class="level-xp" id="level-xp">0 XP</div>
        <div class="xp-bar"><div class="xp-fill" id="xp-fill" style="width:0%"></div></div>
      </div>
    </div>

    <div class="stats-grid">
      <div class="stat-card"><div class="value" id="stat-sessions">0</div><div class="label">SÃ©ances</div></div>
      <div class="stat-card"><div class="value" id="stat-best">0%</div><div class="label">Meilleur score</div></div>
      <div class="stat-card"><div class="value" id="stat-questions">0</div><div class="label">Questions</div></div>
      <div class="stat-card"><div class="value" id="stat-global">0%</div><div class="label">RÃ©ussite</div></div>
    </div>

    <button class="btn btn-primary" onclick="startMode('normal')">ğŸš€ SÃ©ance normale (20 min)</button>
    <div id="btn-revision-wrap" style="display:none">
      <button class="btn btn-revision" onclick="startMode('revision')">ğŸ”„ RÃ©vision â€” erreurs passÃ©es (15 min)</button>
    </div>
    <div id="btn-eval-wrap" style="display:none">
      <button class="btn btn-eval" onclick="startMode('evaluation')">ğŸ¯ Ã‰valuation Finale â€” max 1 faute !</button>
    </div>
    <hr class="sep">
    <button class="btn btn-secondary" onclick="showScreen('screen-stats')">ğŸ“Š Mon historique</button>
    <button class="btn btn-secondary" onclick="showScreen('screen-verbs')">ğŸ“– Les verbes travaillÃ©s</button>
    <hr class="sep">
    <button class="btn btn-secondary" onclick="showScreen('screen-sync')">ğŸ”„ TransfÃ©rer ma progression</button>
    <a href="index.html" class="btn btn-secondary" style="text-align:center;text-decoration:none">ğŸ  Retour au menu</a>
  </div>
</div>

<!-- ===== SESSION ===== -->
<div id="screen-session" class="screen">
  <div class="card">
    <div class="session-header">
      <span class="mode-label" id="mode-label">ğŸš€ SÃ©ance</span>
      <div class="score-display">
        <div>âœ… <span id="sess-correct">0</span></div>
        <div>âŒ <span id="sess-wrong">0</span></div>
        <div>â­ <span id="sess-score">0</span></div>
      </div>
      <div id="timer-text">20:00</div>
    </div>
    <div class="timer-bar-container"><div id="timerBar"></div></div>
    <div class="streak" id="streak-display"></div>
    <div class="question-card">
      <div class="question-verb" id="q-verb">â€”</div>
      <div class="question-tense" id="q-tense">â€”</div>
      <div class="pronoun-label">avec le pronom</div>
      <div class="question-pronoun" id="q-pronoun">â€”</div>
      <div class="eval-progress" id="eval-progress"></div>
    </div>
    <input type="text" class="answer-input" id="answer-input" placeholder="Ã‰cris ta rÃ©ponse ici..." onkeydown="if(event.key==='Enter') checkAnswer()" autocomplete="off" autocapitalize="none" spellcheck="false">
    <button class="btn btn-primary" id="submit-btn" onclick="checkAnswer()">âœ… Valider</button>
    <div class="feedback" id="feedback">
      <div class="feedback-title" id="feedback-title"></div>
      <div class="feedback-answer" id="feedback-answer"></div>
    </div>
    <table class="conj-table" id="conj-table"></table>
    <button class="btn btn-secondary" id="next-btn" style="display:none" onclick="nextQuestion()">â¡ï¸ Question suivante</button>
    <button class="btn btn-danger" id="end-btn" style="display:none" onclick="endSession()">ğŸ Terminer</button>
  </div>
</div>

<!-- ===== RÃ‰SULTATS ===== -->
<div id="screen-result" class="screen">
  <div class="card">
    <h2 style="text-align:center" id="result-title">ğŸ† Fin de la sÃ©ance !</h2>
    <div id="result-normal"><div class="result-score pop" id="result-pct">â€”</div></div>
    <div id="result-eval" style="display:none"><div class="pop" id="eval-verdict">â€”</div></div>
    <div class="result-stats">
      <div class="result-stat"><div class="val" id="res-total">0</div><div class="lbl">Questions</div></div>
      <div class="result-stat"><div class="val" id="res-correct">0</div><div class="lbl">Correctes âœ…</div></div>
      <div class="result-stat"><div class="val" id="res-wrong">0</div><div class="lbl">Erreurs âŒ</div></div>
    </div>
    <div class="xp-gain" id="xp-gain" style="display:none"></div>
    <div id="errors-section" style="display:none">
      <div class="errors-section"><h3>âŒ Ã€ retravailler :</h3><div id="errors-list"></div></div>
    </div>
    <button class="btn btn-primary" id="res-new-session" onclick="startMode('normal')">ğŸ”„ Nouvelle sÃ©ance</button>
    <button class="btn btn-secondary" onclick="showScreen('screen-home')">ğŸ  Accueil conjugaison</button>
  </div>
</div>

<!-- ===== HISTORIQUE ===== -->
<div id="screen-stats" class="screen">
  <div class="card">
    <h2>ğŸ“Š Mon historique</h2>
    <h3>âŒ Points faibles</h3><div id="stats-weak"><p class="empty-msg">Pas encore d'erreurs.</p></div>
    <hr class="sep">
    <h3>âœ… Points forts</h3><div id="stats-strong"><p class="empty-msg">Joue pour voir tes progrÃ¨s !</p></div>
    <hr class="sep">
    <h3>ğŸ“ˆ Combinaisons travaillÃ©es</h3><div id="stats-all"></div>
    <button class="btn btn-secondary" onclick="showScreen('screen-home')" style="margin-top:18px">â† Retour</button>
  </div>
</div>

<!-- ===== VERBES ===== -->
<div id="screen-verbs" class="screen">
  <div class="card">
    <h2>ğŸ“– Les verbes travaillÃ©s</h2>
    <p style="color:#888;font-size:0.86em;margin-bottom:12px">ğŸ”´ Ã‰valuations &nbsp;|&nbsp; ğŸ”µ SupplÃ©mentaires</p>
    <div class="verb-grid" id="verb-grid"></div>
    <button class="btn btn-secondary" onclick="showScreen('screen-home')" style="margin-top:18px">â† Retour</button>
  </div>
</div>

<!-- ===== TRANSFERT ===== -->
<div id="screen-sync" class="screen">
  <div class="card">
    <h2>ğŸ”„ TransfÃ©rer</h2>
    <h3>ğŸ“¤ Exporter</h3>
    <textarea id="export-area" readonly rows="3" class="sync-textarea" style="background:#f8f9ff" onclick="this.select()"></textarea>
    <button class="btn btn-primary" onclick="exportData()" style="margin-top:6px">ğŸ“¤ GÃ©nÃ©rer le code</button>
    <button class="btn btn-secondary" id="copy-btn" onclick="copyCode()" style="display:none">ğŸ“‹ Copier</button>
    <hr class="sep">
    <h3>ğŸ“¥ Importer</h3>
    <textarea id="import-area" rows="3" class="sync-textarea" placeholder="Colle le code iciâ€¦"></textarea>
    <button class="btn btn-eval" onclick="importData()">ğŸ“¥ Importer</button>
    <div id="import-msg" style="margin-top:8px;text-align:center;font-weight:bold;font-size:0.92em"></div>
    <hr class="sep">
    <button class="btn btn-secondary" onclick="showScreen('screen-home')">â† Retour</button>
  </div>
</div>

<script src="js/engine.js"></script>
<script src="js/conjugaison.js"></script>
<script>
const SUBJECT = 'conjugaison';
let gameData, session, timerInterval;

// ================================================================
// INIT â€” vÃ©rifier qu'un profil est sÃ©lectionnÃ©
// ================================================================
(function init() {
  const last = getLastProfile();
  if (!last || !PROFILES.find(p => p.id === last)) {
    window.location.href = 'index.html';
    return;
  }
  setProfile(last);
  gameData = loadSave(SUBJECT);
  document.getElementById('home-subtitle').textContent =
    `${currentProfile.avatar} ${currentProfile.name} â€” Deviens un maÃ®tre des verbes !`;
  updateHomeUI();
  buildVerbList();
  // Service Worker
  if ('serviceWorker' in navigator) navigator.serviceWorker.register('sw.js').catch(() => {});
})();

// ================================================================
// ACCUEIL
// ================================================================
function updateHomeUI() {
  const level = getLevel(gameData.xp);
  const next  = LEVELS[LEVELS.indexOf(level) + 1];
  document.getElementById('level-icon').textContent = level.icon;
  document.getElementById('level-name').textContent = level.name;
  if (next) {
    document.getElementById('xp-fill').style.width  = ((gameData.xp - level.min) / (next.min - level.min) * 100) + '%';
    document.getElementById('level-xp').textContent = `${gameData.xp} XP â€” prochain : ${next.min} XP`;
  } else {
    document.getElementById('xp-fill').style.width  = '100%';
    document.getElementById('level-xp').textContent = `${gameData.xp} XP â€” MAX ! ğŸ‰`;
  }
  document.getElementById('stat-sessions').textContent  = gameData.sessions;
  document.getElementById('stat-best').textContent      = gameData.bestPct + '%';
  document.getElementById('stat-questions').textContent = gameData.totalQ;
  document.getElementById('stat-global').textContent    =
    (gameData.totalQ > 0 ? Math.round(gameData.totalCorrect / gameData.totalQ * 100) : 0) + '%';

  const errors = getErrorCombos(gameData.stats);
  document.getElementById('btn-revision-wrap').style.display = errors.length > 0  ? '' : 'none';
  document.getElementById('btn-eval-wrap').style.display     = errors.length >= 3 ? '' : 'none';
}

// ================================================================
// MODES
// ================================================================
function startMode(mode) {
  clearInterval(timerInterval);
  const errors = getErrorCombos(gameData.stats);
  if (mode === 'evaluation' && errors.length === 0) { alert('Pas encore d\'erreurs !'); return; }

  const evalQs = mode === 'evaluation' ? shuffle(errors).slice(0, 35).map(e => {
    const [inf, tense, p] = e.key.split('|');
    return { inf, tense, person: parseInt(p) };
  }) : null;

  session = {
    mode, correct: 0, wrong: 0, streak: 0, xpGained: 0, score: 0,
    errors: [], answered: false,
    evalQuestions: evalQs, evalIndex: 0,
    pool: mode === 'normal' ? buildNormalPool(gameData.stats) :
          mode === 'revision' ? buildRevisionPool(errors) : null,
    timeLeft:  mode === 'evaluation' ? null : mode === 'revision' ? 15*60 : 20*60,
    totalTime: mode === 'evaluation' ? null : mode === 'revision' ? 15*60 : 20*60
  };

  const labels  = { normal:'ğŸš€ SÃ©ance', revision:'ğŸ”„ RÃ©vision', evaluation:'ğŸ¯ Ã‰valuation' };
  const classes = { normal:'mode-normal', revision:'mode-revision', evaluation:'mode-eval' };
  const lbl = document.getElementById('mode-label');
  lbl.textContent = labels[mode]; lbl.className = 'mode-label ' + classes[mode];
  document.getElementById('timer-text').style.display = session.timeLeft != null ? '' : 'none';
  document.getElementById('timerBar').parentElement.style.display = session.timeLeft != null ? '' : 'none';

  showScreen('screen-session');
  updateSessionUI();
  nextQuestion();
  if (session.timeLeft != null) startTimer();
}

function startTimer() {
  timerInterval = setInterval(() => {
    session.timeLeft--;
    const m = Math.floor(session.timeLeft / 60), s = session.timeLeft % 60;
    document.getElementById('timer-text').textContent = `${m}:${s.toString().padStart(2,'0')}`;
    const pct = (session.timeLeft / session.totalTime) * 100;
    const bar = document.getElementById('timerBar');
    bar.style.width = pct + '%';
    bar.style.background = pct < 20 ? '#e74c3c' : pct < 40 ? 'linear-gradient(90deg,#f39c12,#e74c3c)' : 'linear-gradient(90deg,#6C63FF,#FF6B9D)';
    if (session.timeLeft <= 0) { clearInterval(timerInterval); endSession(); }
  }, 1000);
}

// ================================================================
// QUESTIONS
// ================================================================
function nextQuestion() {
  let q;
  if (session.mode === 'evaluation') {
    if (session.evalIndex >= session.evalQuestions.length) { endSession(); return; }
    q = session.evalQuestions[session.evalIndex++];
    document.getElementById('eval-progress').textContent = `Question ${session.evalIndex} / ${session.evalQuestions.length}`;
  } else {
    q = weightedPick(session.pool);
    document.getElementById('eval-progress').textContent = '';
  }
  session.currentQ = q; session.answered = false;
  document.getElementById('q-verb').textContent    = q.inf;
  document.getElementById('q-tense').textContent   = 'â†’ ' + TEMPS[q.tense].nom;
  document.getElementById('q-pronoun').textContent = PRONOMS_FULL[q.person];
  const inp = document.getElementById('answer-input');
  inp.value = ''; inp.className = 'answer-input'; inp.disabled = false; inp.focus();
  document.getElementById('feedback').style.display   = 'none';
  document.getElementById('conj-table').style.display = 'none';
  document.getElementById('submit-btn').style.display = 'block';
  document.getElementById('next-btn').style.display   = 'none';
  document.getElementById('end-btn').style.display    = 'none';
}

function checkAnswer() {
  if (session.answered) return;
  session.answered = true;
  const inp = document.getElementById('answer-input');
  const q = session.currentQ;
  const correct  = checkConjCorrect(inp.value, q.inf, q.tense, q.person);
  const expected = getConj(q.inf, q.tense, q.person);
  recordAnswer(gameData.stats, comboKey([q.inf, q.tense, q.person]), correct);

  const fb = document.getElementById('feedback');
  if (correct) {
    session.correct++; session.streak++;
    let xp = session.streak >= 5 ? 20 : session.streak >= 3 ? 15 : 10;
    session.xpGained += xp; session.score += xp;
    inp.className = 'answer-input correct'; fb.className = 'feedback correct'; fb.style.display = 'block';
    document.getElementById('feedback-title').textContent =
      ['âœ… Excellent !','âœ… Bravo !','âœ… Parfait !','âœ… Super !'][Math.floor(Math.random()*4)] + ' +' + xp + ' XP';
    document.getElementById('feedback-answer').textContent = '';
    const st = document.getElementById('streak-display');
    st.textContent = session.streak >= 5 ? `ğŸ”¥ğŸ”¥ SÃ©rie de ${session.streak} !` : session.streak >= 3 ? `ğŸ”¥ SÃ©rie de ${session.streak} !` : '';
  } else {
    session.wrong++; session.streak = 0;
    session.errors.push({ inf: q.inf, tense: q.tense, person: q.person, user: inp.value, expected });
    inp.className = 'answer-input incorrect'; fb.className = 'feedback incorrect'; fb.style.display = 'block';
    document.getElementById('feedback-title').textContent = 'âŒ Pas tout Ã  fait...';
    document.getElementById('feedback-answer').innerHTML = `La bonne rÃ©ponse : <strong>${expected}</strong>`;
    document.getElementById('streak-display').textContent = '';
  }
  inp.disabled = true;
  document.getElementById('submit-btn').style.display = 'none';
  showConjTable(q.inf, q.tense, q.person);
  document.getElementById('next-btn').style.display = 'block';
  if (session.mode !== 'evaluation') document.getElementById('end-btn').style.display = 'block';
  updateSessionUI();
}

function showConjTable(inf, tense, hl) {
  const t = document.getElementById('conj-table');
  let h = `<tr class="conj-header"><td colspan="2">${inf} â€” ${TEMPS[tense].nom}</td></tr>`;
  PRONOMS_FULL.forEach((pr, i) => h += `<tr class="${i===hl?'highlight-row':''}"><td>${pr}</td><td>${getDisplayConj(inf,tense,i)}</td></tr>`);
  t.innerHTML = h; t.style.display = 'table';
}

function updateSessionUI() {
  document.getElementById('sess-score').textContent   = session.score;
  document.getElementById('sess-correct').textContent = session.correct;
  document.getElementById('sess-wrong').textContent   = session.wrong;
}

// ================================================================
// FIN
// ================================================================
function endSession() {
  clearInterval(timerInterval);
  const total = session.correct + session.wrong;
  const pct = total > 0 ? Math.round(session.correct / total * 100) : 0;
  gameData.xp += session.xpGained; gameData.sessions++; gameData.totalQ += total;
  gameData.totalCorrect += session.correct;
  if (pct > gameData.bestPct) gameData.bestPct = pct;
  saveGame(SUBJECT, gameData);

  document.getElementById('res-total').textContent   = total;
  document.getElementById('res-correct').textContent = session.correct;
  document.getElementById('res-wrong').textContent   = session.wrong;

  const isEval = session.mode === 'evaluation';
  document.getElementById('result-normal').style.display = isEval ? 'none' : 'block';
  document.getElementById('result-eval').style.display   = isEval ? 'block' : 'none';
  document.getElementById('result-title').textContent    = isEval ? 'ğŸ¯ Ã‰valuation Finale' : 'ğŸ† Fin de la sÃ©ance !';

  if (isEval) {
    const passed = session.wrong <= 1;
    const v = document.getElementById('eval-verdict');
    v.className = (passed ? 'result-eval-pass' : 'result-eval-fail') + ' pop';
    v.innerHTML = passed
      ? `âœ… RÃ‰USSI !<br><small>${session.wrong} faute${session.wrong!==1?'s':''} sur ${session.evalQuestions.length}</small>`
      : `ğŸ’ª CONTINUE !<br><small>${session.wrong} faute${session.wrong>1?'s':''} â€” objectif : max 1</small>`;
    document.getElementById('xp-gain').style.display = 'none';
    document.getElementById('res-new-session').onclick = () => startMode('evaluation');
    document.getElementById('res-new-session').textContent = 'ğŸ¯ Retenter';
  } else {
    const emoji = pct >= 90 ? 'ğŸ†' : pct >= 70 ? 'â­' : pct >= 50 ? 'ğŸ‘' : 'ğŸ’ª';
    document.getElementById('result-pct').textContent = emoji + ' ' + pct + '%';
    const xpEl = document.getElementById('xp-gain');
    xpEl.style.display = 'block'; xpEl.textContent = `+${session.xpGained} XP !`;
    document.getElementById('res-new-session').onclick = () => startMode('normal');
    document.getElementById('res-new-session').textContent = 'ğŸ”„ Nouvelle sÃ©ance';
  }

  const errSec = document.getElementById('errors-section');
  if (session.errors.length > 0) {
    errSec.style.display = 'block';
    document.getElementById('errors-list').innerHTML = session.errors.slice(0,10).map(e =>
      `<div class="error-item"><strong>${e.inf}</strong> (${TEMPS[e.tense].nom}, ${PRONOMS_FULL[e.person]}) :
      <span class="wrong-ans">${e.user||'(vide)'}</span> â†’ <span class="right-ans">${e.expected}</span></div>`
    ).join('');
  } else errSec.style.display = 'none';

  showScreen('screen-result');
  updateHomeUI();
}

// ================================================================
// STATS
// ================================================================
function buildStatsScreen() {
  const errors = getErrorCombos(gameData.stats);
  const weakEl = document.getElementById('stats-weak');
  if (errors.length === 0) { weakEl.innerHTML = '<p class="empty-msg">Pas encore d\'erreurs.</p>'; }
  else { weakEl.innerHTML = errors.slice(0,10).map(e => {
    const [inf,tense,p] = e.key.split('|');
    return `<div class="weak-combo"><div><div class="combo-name">${inf}</div><div class="combo-tense">${TEMPS[tense].nom} â€” ${PRONOMS_FULL[p]}</div></div><div class="combo-rate">${e.stat.wrong}/${e.stat.asked} (${Math.round(e.rate*100)}%)</div></div>`;
  }).join(''); }

  const all = Object.entries(gameData.stats).filter(([,s]) => s.asked >= 1).map(([key,s]) => {
    const [inf,tense,p] = key.split('|');
    return { inf, tense, person: parseInt(p), stat: s, rate: s.wrong/s.asked };
  });
  const strong = all.filter(e => e.stat.wrong === 0 || (e.stat.asked >= 2 && e.rate < 0.25)).sort((a,b) => b.stat.asked - a.stat.asked).slice(0,10);
  const strongEl = document.getElementById('stats-strong');
  if (strong.length === 0) strongEl.innerHTML = '<p class="empty-msg">Joue pour voir tes progrÃ¨s !</p>';
  else strongEl.innerHTML = strong.map(e => {
    const ok = e.stat.asked - e.stat.wrong;
    return `<div class="weak-combo good-combo"><div><div class="combo-name">${e.inf}</div><div class="combo-tense">${TEMPS[e.tense].nom} â€” ${PRONOMS_FULL[e.person]}</div></div><div class="combo-rate">${ok}/${e.stat.asked} âœ…</div></div>`;
  }).join('');

  const sorted = all.sort((a,b) => b.stat.asked - a.stat.asked);
  const allEl = document.getElementById('stats-all');
  if (sorted.length === 0) allEl.innerHTML = '<p class="empty-msg">Aucune.</p>';
  else {
    allEl.innerHTML = sorted.slice(0,30).map(e => {
      const c = e.rate < 0.2 ? '#27ae60' : e.rate > 0.5 ? '#e74c3c' : '#e67e22';
      const cls = e.rate < 0.2 ? 'good-combo' : '';
      return `<div class="weak-combo ${cls}" style="margin:3px 0"><div><div class="combo-name" style="font-size:0.93em">${e.inf}</div><div class="combo-tense">${TEMPS[e.tense].nom} â€” ${PRONOMS_FULL[e.person]}</div></div><div style="font-weight:bold;color:${c};font-size:0.9em">${e.stat.wrong}/${e.stat.asked}</div></div>`;
    }).join('');
    if (sorted.length > 30) allEl.innerHTML += `<p class="empty-msg">â€¦ et ${sorted.length-30} autres</p>`;
  }
}

// Override showScreen to build stats
const _showScreen = showScreen;
showScreen = function(id) { _showScreen(id); if (id === 'screen-stats') buildStatsScreen(); };

// ================================================================
// VERBES
// ================================================================
function buildVerbList() {
  document.getElementById('verb-grid').innerHTML = ALL_VERBS.sort().map(inf =>
    `<span class="verb-chip ${V[inf].priority?'priority':''}">${inf}</span>`
  ).join('');
}

// ================================================================
// EXPORT / IMPORT
// ================================================================
function exportData() {
  document.getElementById('export-area').value = doExport(SUBJECT, gameData);
  document.getElementById('copy-btn').style.display = 'block';
}
function copyCode() {
  const a = document.getElementById('export-area'); a.select(); a.setSelectionRange(0,99999);
  navigator.clipboard.writeText(a.value).then(() => {
    document.getElementById('copy-btn').textContent = 'âœ… CopiÃ© !';
    setTimeout(() => document.getElementById('copy-btn').textContent = 'ğŸ“‹ Copier', 2000);
  }).catch(() => { document.execCommand('copy'); });
}
function importData() {
  const msg = document.getElementById('import-msg');
  const raw = document.getElementById('import-area').value.trim();
  if (!raw) { msg.textContent = 'âŒ Colle un code !'; msg.style.color = '#e74c3c'; return; }
  try {
    const imported = doImport(raw);
    if (gameData.totalQ > 0) {
      if (confirm('Fusionner avec ta progression ? OK=Fusionner, Annuler=Remplacer')) {
        gameData.xp += imported.data.xp; gameData.sessions += imported.data.sessions;
        gameData.totalQ += imported.data.totalQ; gameData.totalCorrect += imported.data.totalCorrect;
        gameData.bestPct = Math.max(gameData.bestPct, imported.data.bestPct);
        Object.entries(imported.data.stats).forEach(([k,s]) => {
          if (!gameData.stats[k]) gameData.stats[k] = {asked:0,wrong:0};
          gameData.stats[k].asked += s.asked; gameData.stats[k].wrong += s.wrong;
        });
      } else gameData = imported.data;
    } else gameData = imported.data;
    saveGame(SUBJECT, gameData); updateHomeUI();
    msg.textContent = 'âœ… ImportÃ© !'; msg.style.color = '#27ae60';
  } catch { msg.textContent = 'âŒ Code invalide.'; msg.style.color = '#e74c3c'; }
}
</script>
</body>
</html>
